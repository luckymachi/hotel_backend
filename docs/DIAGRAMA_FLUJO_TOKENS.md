# Diagrama de Flujo - Sistema de Encuestas con Tokens

## Flujo Visual Completo

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         FASE 1: CHECKOUT                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Cliente â”€â”€[Checkout]â”€â”€> Backend
                           â”‚
                           â”œâ”€ Actualizar estado de reserva
                           â”‚
                           â”œâ”€ Generar token Ãºnico (64 chars)
                           â”‚   â””â”€ crypto/rand â†’ 32 bytes â†’ hex
                           â”‚
                           â”œâ”€ Guardar en survey_tokens table
                           â”‚   â”œâ”€ token: "abc123def456..."
                           â”‚   â”œâ”€ reservation_id: 123
                           â”‚   â”œâ”€ client_id: 45
                           â”‚   â”œâ”€ expires_at: NOW() + 30 days
                           â”‚   â””â”€ used: false
                           â”‚
                           â””â”€ Enviar email
                               â””â”€ Link: https://hotel.com/encuesta?token=abc123...


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   FASE 2: VALIDACIÃ“N DE TOKEN                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Cliente â”€â”€[Click en email]â”€â”€> Frontend
                                  â”‚
                                  â”œâ”€ Extraer token del URL
                                  â”‚   â””â”€ ?token=abc123def456...
                                  â”‚
                                  â””â”€ GET /api/encuestas/validar/:token
                                      â”‚
                                      â–¼
                                   Backend
                                      â”‚
                                      â”œâ”€ Buscar token en DB
                                      â”‚
                                      â”œâ”€ Verificar:
                                      â”‚   â”œâ”€ Â¿Token existe? âœ“
                                      â”‚   â”œâ”€ Â¿No estÃ¡ usado? âœ“
                                      â”‚   â””â”€ Â¿No expirÃ³? âœ“
                                      â”‚
                                      â””â”€ Response:
                                          {
                                            "valid": true,
                                            "reservationId": 123,
                                            "clientId": 45
                                          }
                                      â–¼
                                   Frontend
                                      â”‚
                                      â””â”€ Mostrar formulario


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 FASE 3: COMPLETAR ENCUESTA                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Cliente â”€â”€[Completa formulario]â”€â”€> Frontend
                                       â”‚
                                       â””â”€ POST /api/encuestas
                                           Body: {
                                             "token": "abc123...",
                                             "generalExperience": 5,
                                             "cleanliness": 5,
                                             "staffAttention": 4,
                                             "comfort": 5,
                                             "recommendation": 5,
                                             "additionalServices": 4,
                                             "comments": "Excelente!"
                                           }
                                           â–¼
                                        Backend
                                           â”‚
                                           â”œâ”€ ValidateToken()
                                           â”‚   â”œâ”€ Â¿Token vÃ¡lido? âœ“
                                           â”‚   â””â”€ Obtener IDs
                                           â”‚
                                           â”œâ”€ Asignar IDs a encuesta
                                           â”‚   â”œâ”€ reservationId: 123
                                           â”‚   â””â”€ clientId: 45
                                           â”‚
                                           â”œâ”€ Validar puntuaciones (1-5)
                                           â”‚
                                           â”œâ”€ Guardar en satisfaction_survey
                                           â”‚
                                           â”œâ”€ Marcar token como usado
                                           â”‚   â””â”€ UPDATE survey_tokens
                                           â”‚       SET used = true
                                           â”‚
                                           â””â”€ Response: 201 Created
                                           â–¼
                                        Frontend
                                           â”‚
                                           â””â”€ Mostrar: "Â¡Gracias!"


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      CASOS DE ERROR                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

âŒ Token no existe
   â””â”€> Response: {"valid": false}
       â””â”€> Frontend: "Token invÃ¡lido"

âŒ Token ya fue usado
   â””â”€> Response: {"valid": false}
       â””â”€> Frontend: "Esta encuesta ya fue completada"

âŒ Token expirÃ³ (> 30 dÃ­as)
   â””â”€> Response: {"valid": false}
       â””â”€> Frontend: "El link ha expirado"

âŒ Intentar crear encuesta con token usado
   â””â”€> Response: {"error": "el token ya fue utilizado"}
       â””â”€> Frontend: "Error al enviar encuesta"

âŒ Puntuaciones fuera de rango (< 1 o > 5)
   â””â”€> Response: {"error": "las puntuaciones deben estar entre 1 y 5"}
       â””â”€> Frontend: "Valores invÃ¡lidos"


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ESTRUCTURA DE DATOS                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

survey_tokens
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ token_id   â”‚ token               â”‚ reservation_id â”‚ client_id â”‚ expires_at â”‚ used â”‚ created_at â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1          â”‚ abc123def456...xyz  â”‚ 123            â”‚ 45        â”‚ 2024-02-15 â”‚ falseâ”‚ 2024-01-15 â”‚
â”‚ 2          â”‚ 789ghi012jkl...mno  â”‚ 124            â”‚ 46        â”‚ 2024-02-16 â”‚ true â”‚ 2024-01-16 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                                       â†‘              â†‘
                                                                       â”‚              â”‚
                                                         Expira 30 dÃ­as despuÃ©s  Fecha de creaciÃ³n


satisfaction_survey
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ survey_id â”‚ reservation_id â”‚ client_id â”‚ general_exp      â”‚ cleanlinessâ”‚ staff_att  â”‚ comfort â”‚ recommend  â”‚ add_services   â”‚ comments â”‚ resp_date â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1         â”‚ 123            â”‚ 45        â”‚ 5                â”‚ 5          â”‚ 4          â”‚ 5       â”‚ 5          â”‚ 4              â”‚ "Excel!" â”‚ 2024-01-20â”‚
â”‚ 2         â”‚ 124            â”‚ 46        â”‚ 4                â”‚ 5          â”‚ 5          â”‚ 4       â”‚ 4          â”‚ 3              â”‚ NULL     â”‚ 2024-01-21â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†‘                              â†‘                   â†‘            â†‘           â†‘          â†‘              â†‘               â†‘
              â”‚                              â”‚                   â”‚            â”‚           â”‚          â”‚              â”‚               â”‚
         Unique per                    Todas las puntuaciones deben estar                                      Comentarios
         reservation                        entre 1 y 5                                                        (opcional)


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  ARQUITECTURA DEL CÃ“DIGO                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

HTTP Layer (Fiber)
    â”‚
    â”‚  GET  /api/encuestas/validar/:token
    â”‚  POST /api/encuestas
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ SatisfactionSurveyHandler        â”‚
â”‚  - ValidateToken()               â”‚
â”‚  - CreateSurvey()                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â”‚  Calls service methods
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ SatisfactionSurveyService        â”‚
â”‚  - ValidateToken()               â”‚
â”‚  - CreateSurveyWithToken()       â”‚
â”‚  - CreateTokenForReservation()   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â”‚  Uses repositories
    â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â–¼                 â–¼                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ SurveyRepo  â”‚  â”‚ TokenRepo   â”‚  â”‚ ReservaRepo â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚                 â”‚                 â”‚
    â”‚                 â”‚                 â”‚
    â–¼                 â–¼                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          PostgreSQL Database            â”‚
â”‚  - satisfaction_survey                  â”‚
â”‚  - survey_tokens                        â”‚
â”‚  - reservas                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      SEGURIDAD                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ğŸ”’ GeneraciÃ³n de Token:
   crypto/rand.Read(32 bytes) â†’ hex.EncodeToString() â†’ 64 chars
   
   Ejemplo: 
   Random bytes: [0x3a, 0xf7, 0x9c, ...]
   Hex string:   "3af79c2e8b..."
   
   EntropÃ­a: 256 bits (2^256 combinaciones posibles)
   Probabilidad de colisiÃ³n: ~0 (prÃ¡cticamente imposible)

ğŸ”’ Validaciones en Backend:
   âœ“ Token existe en DB
   âœ“ Token no estÃ¡ marcado como usado
   âœ“ Token no expirÃ³ (created_at + 30 days > NOW())
   âœ“ Puntuaciones entre 1 y 5
   âœ“ Reserva existe
   âœ“ Cliente coincide con reserva

ğŸ”’ Uso Ãšnico:
   UPDATE survey_tokens 
   SET used = true 
   WHERE token = ?
   
   â†’ Previene mÃºltiples encuestas con mismo token

ğŸ”’ ExpiraciÃ³n AutomÃ¡tica:
   expires_at = created_at + INTERVAL '30 days'
   
   Query validaciÃ³n:
   WHERE token = ? 
     AND used = false 
     AND expires_at > NOW()


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    EMAIL TEMPLATE                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ De: Hotel Paradise <noreply@hotelparadise.com>                 â”‚
â”‚ Para: cliente@email.com                                        â”‚
â”‚ Asunto: Encuesta de SatisfacciÃ³n - Tu OpiniÃ³n es Importante   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                â”‚
â”‚   Â¡Gracias por hospedarte con nosotros!                       â”‚
â”‚                                                                â”‚
â”‚   Esperamos que hayas disfrutado tu estadÃ­a en nuestro hotel. â”‚
â”‚                                                                â”‚
â”‚   Nos encantarÃ­a conocer tu opiniÃ³n para seguir mejorando     â”‚
â”‚   nuestros servicios. Por favor, completa nuestra breve       â”‚
â”‚   encuesta de satisfacciÃ³n:                                   â”‚
â”‚                                                                â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚
â”‚   â”‚   Completar Encuesta Ahora     â”‚                          â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚
â”‚                                                                â”‚
â”‚   Este link es vÃ¡lido por 30 dÃ­as.                            â”‚
â”‚                                                                â”‚
â”‚   Si tienes alguna pregunta, no dudes en contactarnos.        â”‚
â”‚                                                                â”‚
â”‚   Saludos,                                                     â”‚
â”‚   Equipo Hotel Paradise                                       â”‚
â”‚                                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Link real: 
https://hotelparadise.com/encuesta?token=3af79c2e8b1d4f6a9c0e2b7d8a5f3c1e4b9d6a0c2f5e8a1b4d7c0e3a6f9b2d5c8


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      MÃ‰TRICAS Y ANALYTICS                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Query para obtener promedios:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ SELECT                                                          â”‚
â”‚   AVG(general_experience) as avg_general,                       â”‚
â”‚   AVG(cleanliness) as avg_cleanliness,                          â”‚
â”‚   AVG(staff_attention) as avg_staff,                            â”‚
â”‚   AVG(comfort) as avg_comfort,                                  â”‚
â”‚   AVG(recommendation) as avg_recommendation,                    â”‚
â”‚   AVG(additional_services) as avg_services,                     â”‚
â”‚   COUNT(*) as total_surveys                                     â”‚
â”‚ FROM satisfaction_survey;                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Resultado ejemplo:
{
  "avg_general": 4.5,
  "avg_cleanliness": 4.8,
  "avg_staff": 4.6,
  "avg_comfort": 4.7,
  "avg_recommendation": 4.5,
  "avg_services": 4.3,
  "total_surveys": 10
}

Dashboard potencial:
  â­ SatisfacciÃ³n General: 4.5/5 â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Œ 90%
  ğŸ§¹ Limpieza:            4.8/5 â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Œ 96%
  ğŸ‘¥ Personal:            4.6/5 â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ– 92%
  ğŸ›ï¸  Confort:             4.7/5 â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ– 94%
  ğŸ‘ RecomendaciÃ³n:       4.5/5 â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Œ 90%
  â• Servicios Extra:     4.3/5 â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ– 86%
  
  Total de encuestas: 10


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  MANTENIMIENTO Y LIMPIEZA                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Tarea periÃ³dica (opcional - ejecutar semanalmente):

DELETE FROM survey_tokens 
WHERE expires_at < NOW() - INTERVAL '7 days';

Esto elimina tokens que expiraron hace mÃ¡s de 7 dÃ­as
(mantiene tokens reciÃ©n expirados por si se necesitan para debugging)


EstadÃ­sticas de uso:

SELECT 
  COUNT(*) as total_tokens,
  SUM(CASE WHEN used THEN 1 ELSE 0 END) as used_tokens,
  SUM(CASE WHEN expires_at < NOW() THEN 1 ELSE 0 END) as expired_tokens,
  SUM(CASE WHEN NOT used AND expires_at > NOW() THEN 1 ELSE 0 END) as valid_tokens
FROM survey_tokens;

Resultado ejemplo:
{
  "total_tokens": 50,
  "used_tokens": 30,       // 60% conversion rate
  "expired_tokens": 15,    // 30% expired without use
  "valid_tokens": 5        // 10% pending
}
```

## Leyenda de SÃ­mbolos

- `â”€â”€>` : Flujo de datos
- `â”œâ”€` : Paso intermedio
- `â””â”€` : Ãšltimo paso
- `â–¼` : ContinÃºa hacia abajo
- `âœ“` : VerificaciÃ³n exitosa
- `âŒ` : Error/Fallo
- `ğŸ”’` : Aspecto de seguridad
- `â­` : MÃ©trica/EstadÃ­stica
