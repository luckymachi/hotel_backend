create table alert
(
    alert_id          serial
        primary key,
    message           varchar(100) not null,
    was_read          boolean      not null,
    read_date         timestamp    not null,
    registration_date timestamp    not null,
    alert_type        integer      not null,
    status            integer      not null
);

alter table alert
    owner to lapantera;

create table campaign
(
    campaign_id serial
        primary key,
    name        varchar(100) not null,
    description varchar(300) not null,
    start_date  timestamp    not null,
    end_date    timestamp    not null,
    status      integer      not null
);

alter table campaign
    owner to lapantera;

create table promotional_content
(
    content_id       serial
        primary key,
    name             varchar(150)      not null,
    title            varchar(200)      not null,
    description      text              not null,
    destination_link varchar(500)      not null,
    button_text      varchar(50)       not null,
    start_date       timestamp         not null,
    end_date         timestamp         not null,
    views_count      integer default 0 not null,
    clicks_count     integer default 0 not null
);

alter table promotional_content
    owner to lapantera;

create table event
(
    event_id             serial
        primary key,
    title                varchar(100)          not null,
    button_title         varchar(200)          not null,
    description          varchar(200)          not null,
    date                 timestamp             not null,
    start_date           timestamp             not null,
    end_date             timestamp             not null,
    location             varchar(200)          not null,
    cover_image_url      varchar(500)          not null,
    banner_image_url     varchar(500)          not null,
    max_capacity         integer               not null,
    entry_price          double precision      not null,
    requires_reservation boolean default false not null,
    active               boolean default true  not null,
    creation_date        timestamp             not null
);

alter table event
    owner to lapantera;

create table contact_form
(
    form_id       serial
        primary key,
    user_id       integer,
    name          varchar(100)            not null,
    email         varchar(150)            not null,
    phone         varchar(20)             not null,
    message       text                    not null,
    status        form_status             not null,
    response_date timestamp,
    sent_date     timestamp default now() not null
);

alter table contact_form
    owner to lapantera;

create table hotel_facilities
(
    facility_id          serial
        constraint instalacionesdelhotel_pkey
            primary key,
    name                 varchar(100)          not null,
    category             facility_category     not null,
    schedule             varchar(100)          not null,
    description          text                  not null,
    location             varchar(100)          not null,
    floor                integer               not null,
    main_image_url       varchar(500)          not null,
    capacity             integer               not null,
    requires_reservation boolean default false not null,
    additional_cost      double precision      not null,
    active               boolean default true  not null,
    creation_date        timestamp             not null
);

alter table hotel_facilities
    owner to lapantera;

create table notification
(
    notification_id   serial
        primary key,
    message           varchar(100) not null,
    sent_date         timestamp    not null,
    notification_type varchar(20)  not null,
    status            integer      not null
);

alter table notification
    owner to lapantera;

create table person
(
    person_id         serial
        primary key,
    name              varchar(100)           not null,
    first_surname     varchar(100)           not null,
    second_surname    varchar(100),
    document_number   varchar(10)            not null,
    gender            varchar(10)            not null,
    email             varchar(100)           not null
        unique,
    phone_1           varchar(20)            not null,
    phone_2           varchar(20),
    reference_city    varchar(50),
    reference_country varchar(50),
    active            boolean   default true not null,
    creation_date     timestamp default CURRENT_TIMESTAMP
);

alter table person
    owner to lapantera;

create table client
(
    client_id                serial
        primary key,
    capture_channel          capture_channel             not null,
    travels_with_children    integer        default 0    not null,
    season_interest          varchar(100)   default '-'::character varying,
    last_status_change_date  timestamp      default CURRENT_TIMESTAMP,
    registration_date        timestamp      default CURRENT_TIMESTAMP,
    active                   boolean        default true not null,
    capture_status           capture_status              not null,
    person_id                integer
        constraint cliente_personaid_fkey
            references person,
    client_type              client_type                 not null,
    total_bookings           integer        default 0,
    total_revenue            numeric(10, 2) default 0.00,
    rating                   numeric(3, 2)  default 0.00,
    average_value            numeric(10, 2) default 0.00,
    age                      integer        default 0,
    marital_status           varchar(50),
    guest_type               varchar(50),
    contact_language         varchar(50),
    average_visit_duration   numeric(10, 2) default 0.0,
    preferred_booking_season varchar(50),
    main_contact_channel     varchar(50),
    contact_frequency        varchar(50),
    last_contact_date        timestamp
);

alter table client
    owner to lapantera;

create table conversation_history
(
    id         varchar(100)                        not null
        primary key,
    client_id  integer
        constraint conversation_history_cliente_id_fkey
            references client,
    messages   jsonb                               not null,
    created_at timestamp default CURRENT_TIMESTAMP not null,
    updated_at timestamp default CURRENT_TIMESTAMP not null
);

alter table conversation_history
    owner to lapantera;

create index idx_conversation_client
    on conversation_history (client_id);

create index idx_conversation_updated
    on conversation_history (updated_at desc);

create table message
(
    message_id        serial
        primary key,
    content           varchar(100)                        not null,
    registration_date timestamp default CURRENT_TIMESTAMP not null,
    client_id         integer
        constraint mensaje_clienteid_fkey
            references client
);

alter table message
    owner to lapantera;

create table publication
(
    publication_id    serial
        primary key,
    title             varchar(100) not null,
    content           varchar(250) not null,
    likes_count       integer      not null,
    comments_count    integer      not null,
    reactions_count   integer      not null,
    publication_date  timestamp    not null,
    registration_date timestamp    not null,
    status            integer      not null,
    campaign_id       integer
        references campaign
);

alter table publication
    owner to lapantera;

create table social_network
(
    social_network_id serial
        primary key,
    name              varchar(100) not null,
    api_key           varchar(200) not null,
    status            integer      not null
);

alter table social_network
    owner to lapantera;

create table interaction
(
    interaction_id      serial
        primary key,
    detail              varchar(400)     not null,
    publication_date    timestamp        not null,
    status              integer          not null,
    analysis_date       timestamp        not null,
    social_user         varchar(250)     not null,
    social_user_country varchar(250)     not null,
    original_comment    varchar(400)     not null,
    alert_id            integer
        constraint interaccion_alertaid_key
            unique
        constraint interaccion_alertaid_fkey
            references alert,
    social_network_id   integer
        constraint fk_int_social_network
            references social_network
        constraint interaccion_redsocialid_fkey
            references social_network,
    rating              double precision not null,
    sentiment           varchar(50)      not null,
    client_id           integer          not null
        constraint fk_client_id
            references client
);

alter table interaction
    owner to lapantera;

create table post
(
    post_id           serial
        primary key,
    title             varchar(100)                        not null,
    content           varchar(100)                        not null,
    likes_count       integer                             not null,
    comments_count    integer                             not null,
    reactions_count   integer                             not null,
    publication_date  timestamp                           not null,
    registration_date timestamp default CURRENT_TIMESTAMP not null,
    campaign_id       integer
        references campaign,
    social_network_id integer
        constraint post_redsocialid_fkey
            references social_network
);

alter table post
    owner to lapantera;

create table reservation
(
    reservation_id    serial
        primary key,
    adults_count      integer            not null,
    children_count    integer            not null,
    status            reservation_status not null,
    client_id         varchar(50)        not null,
    subtotal          double precision   not null,
    discount          double precision   not null,
    confirmation_date timestamp          not null
);

alter table reservation
    owner to lapantera;

create table payment
(
    payment_id     serial
        primary key,
    amount         double precision not null,
    date           timestamp        not null,
    payment_method payment_method   not null,
    status         payment_status   not null,
    reservation_id integer
        constraint pago_reservaid_fkey
            references reservation
);

alter table payment
    owner to lapantera;

create table service
(
    service_id  serial
        primary key,
    name        varchar(50)      not null,
    price       double precision not null,
    description text
);

alter table service
    owner to lapantera;

create table reservation_service
(
    reservation_id integer   not null
        constraint reservaxservicio_reservaid_fkey
            references reservation,
    service_id     integer   not null
        constraint reservaxservicio_servicioid_fkey
            references service,
    start_date     timestamp not null,
    end_date       timestamp not null,
    status         integer   not null,
    primary key (service_id, reservation_id)
);

alter table reservation_service
    owner to lapantera;

create table hotel_service
(
    hotel_service_id serial
        primary key,
    title            varchar(100)                        not null,
    button_title     varchar(200)                        not null,
    description      varchar(200)                        not null,
    main_url         varchar(500)                        not null,
    display_order    integer                             not null,
    active           boolean   default true              not null,
    creation_date    timestamp default CURRENT_TIMESTAMP not null
);

alter table hotel_service
    owner to lapantera;

create table multimedia
(
    media_id         serial
        primary key,
    media_type       varchar(10)      not null,
    file_url         varchar(50)      not null,
    format           varchar(10)      not null,
    file_size        double precision not null,
    hotel_service_id integer
        constraint multimedia_serviciohotelid_fkey
            references hotel_service,
    event_id         integer
        constraint multimedia_eventoid_fkey
            references event,
    facility_id      integer
        constraint multimedia_facilityid_fkey
            references hotel_facilities,
    form_id          integer
        constraint multimedia_formularioid_fkey
            references contact_form,
    content_id       integer
        constraint multimedia_contenidoid_fkey
            references promotional_content
);

alter table multimedia
    owner to lapantera;

create table room_type
(
    room_type_id      serial
        constraint tiporoom_pkey
            primary key,
    title             varchar(50)      not null,
    description       text             not null,
    adult_capacity    integer          not null,
    children_capacity integer          not null,
    beds_count        integer          not null,
    price             double precision not null
);

alter table room_type
    owner to lapantera;

create table room
(
    room_id             serial
        primary key,
    name                varchar(50) not null,
    capacity            integer     not null,
    number              varchar(20) not null,
    status              room_status not null,
    room_type_id        integer
        references room_type,
    general_description text        not null,
    media_id            integer
        constraint habitacion_mediaid_fkey
            references multimedia
);

alter table room
    owner to lapantera;

create table reservation_room
(
    reservation_id integer          not null
        constraint reservaxhabitacion_reservaid_fkey
            references reservation,
    room_id        integer          not null
        constraint reservaxhabitacion_habitacionid_fkey
            references room,
    price          double precision not null,
    check_in_date  timestamp        not null,
    check_out_date timestamp        not null,
    status         integer          not null,
    constraint reservaxroom_pkey
        primary key (room_id, reservation_id)
);

alter table reservation_room
    owner to lapantera;

create table client_interaction_history
(
    client_int_hist_id   serial
        primary key,
    client_id            integer     not null
        references client
            on delete cascade,
    interaction_type     varchar(50) not null,
    sentiment            varchar(20),
    description          text,
    interaction_datetime timestamp   not null
);

alter table client_interaction_history
    owner to lapantera;

create table client_notes
(
    client_note_id serial
        primary key,
    client_id      integer not null
        references client
            on delete cascade,
    note_text      text    not null,
    category       varchar(100),
    created_at     timestamp default now()
);

alter table client_notes
    owner to lapantera;

